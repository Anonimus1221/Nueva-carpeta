<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notificaciones - H. Builds</title>
    <link rel="stylesheet" href="/static/css/notifications.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
</head>
<body>
    <div class="particles"></div>
    
    <!-- NAVBAR -->
    <header>
        <nav>
            <div class="logo">ğŸ”” Notificaciones</div>
            <ul class="nav-links">
                <li><a href="/home">ğŸ  Inicio</a></li>
                <li><a href="/chat">ğŸ’¬ Chat</a></li>
                <li><a href="/profile">ğŸ‘¤ Perfil</a></li>
                <li><a href="/purchases">ğŸ›’ Compras</a></li>
                <li><a href="/notifications" class="active">ğŸ”” Notificaciones</a></li>
            </ul>
            <div class="user-menu">
                <img src="{{ user.profile_picture if user.profile_picture else '/static/image/default-avatar.png' }}" 
                     alt="{{ user.name }}" 
                     class="nav-avatar">
                <span>{{ user.name }}</span>
                <button class="btn-logout" onclick="logout()">Cerrar SesiÃ³n</button>
            </div>
        </nav>
    </header>

    <main class="notifications-container">
        <div class="container">
            <div class="page-header">
                <h1>ğŸ”” Centro de Notificaciones</h1>
                <div class="header-actions">
                    <button class="btn-action" onclick="markAllAsRead()">âœ… Marcar todas como leÃ­das</button>
                    <button class="btn-action" onclick="deleteAll()">ğŸ—‘ï¸ Eliminar todas</button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters">
                <button class="filter-btn active" onclick="filterNotifications('all')">
                    Todas <span class="badge">{{ notifications|length }}</span>
                </button>
                <button class="filter-btn" onclick="filterNotifications('unread')">
                    No leÃ­das <span class="badge unread-count">{{ unread_count|default(0) }}</span>
                </button>
                <button class="filter-btn" onclick="filterNotifications('purchases')">
                    ğŸ’° Compras
                </button>
                <button class="filter-btn" onclick="filterNotifications('comments')">
                    ğŸ’¬ Comentarios
                </button>
                <button class="filter-btn" onclick="filterNotifications('system')">
                    âš™ï¸ Sistema
                </button>
            </div>

            <!-- Lista de Notificaciones -->
            <div class="notifications-list">
                {% if notifications %}
                    {% for notification in notifications %}
                    <div class="notification-card {{ 'unread' if not notification.is_read else '' }} {{ notification.type }}"
                         data-id="{{ notification.id }}"
                         data-type="{{ notification.type }}">
                        <div class="notification-icon">
                            {% if notification.type == 'purchase' %}
                                ğŸ›’
                            {% elif notification.type == 'comment' %}
                                ğŸ’¬
                            {% elif notification.type == 'system' %}
                                âš™ï¸
                            {% elif notification.type == 'new_map' %}
                                ğŸ—ºï¸
                            {% else %}
                                ğŸ””
                            {% endif %}
                        </div>

                        <div class="notification-content">
                            <h3>{{ notification.title }}</h3>
                            <p>{{ notification.message }}</p>
                            <span class="notification-time">
                                â° {{ notification.created_at.strftime('%d/%m/%Y %H:%M') }}
                            </span>
                        </div>

                        <div class="notification-actions">
                            {% if not notification.is_read %}
                            <button class="btn-mark-read" onclick="markAsRead({{ notification.id }})" title="Marcar como leÃ­da">
                                âœ“
                            </button>
                            {% endif %}
                            <button class="btn-delete" onclick="deleteNotification({{ notification.id }})" title="Eliminar">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ””</div>
                        <h2>No tienes notificaciones</h2>
                        <p>AquÃ­ aparecerÃ¡n tus compras, comentarios y actualizaciones del sistema</p>
                    </div>
                {% endif %}
            </div>

            <!-- PaginaciÃ³n -->
            {% if total_pages > 1 %}
            <div class="pagination">
                {% if page > 1 %}
                <a href="?page={{ page - 1 }}" class="page-btn">â† Anterior</a>
                {% endif %}
                
                <span class="page-info">PÃ¡gina {{ page }} de {{ total_pages }}</span>
                
                {% if page < total_pages %}
                <a href="?page={{ page + 1 }}" class="page-btn">Siguiente â†’</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </main>

    <footer>
        <p>&copy; 2025 H. Builds. Todos los derechos reservados.</p>
        <p>ğŸ“§ Contacto: <a href="mailto:contacthectorbuilds@gmail.com" style="color: #ff3333; text-decoration: none;">contacthectorbuilds@gmail.com</a></p>
    </footer>

    <script>
        window.userData = {
            name: "{{ user.name }}",
            id: {{ user.id }}
        };
    </script>
    <script src="/static/js/notifications.js"></script>
</body>
</html>
