<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Global - H. Builds</title>
    <link rel="stylesheet" href="/static/css/chat.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="particles"></div>
    
    <!-- NAVBAR -->
    <header>
        <nav>
            <div class="logo">ğŸ’¬ Chat Global</div>
            <ul class="nav-links">
                <li><a href="/home">ğŸ  Inicio</a></li>
                <li><a href="/purchases">ğŸ›’ Compras</a></li>
                <li><a href="/notifications">ğŸ”” Notificaciones</a></li>
                <li><a href="/profile">ğŸ‘¤ Perfil</a></li>
                <li><a href="/contact">ğŸ“ Contacto</a></li>
                <li><a href="/chat" class="active">ğŸ’¬ Chat</a></li>
            </ul>
            <div class="user-menu">
                <img src="{{ user.profile_picture if user.profile_picture else '/static/image/default-avatar.png' }}" 
                     alt="{{ user.name }}" 
                     class="nav-avatar">
                <span>{{ user.name }}</span>
                <button class="btn-logout" onclick="logout()">Cerrar SesiÃ³n</button>
            </div>
        </nav>
    </header>

    <!-- CONTENEDOR PRINCIPAL -->
    <main class="chat-container">
        <!-- SIDEBAR CON USUARIOS CONECTADOS -->
        <aside class="users-sidebar">
            <div class="sidebar-header">
                <h3>ğŸ‘¥ Usuarios Conectados</h3>
                <span class="online-count" id="onlineCount">0</span>
            </div>
            
            <div class="users-list" id="usersList">
                <!-- Lista de usuarios se llenarÃ¡ dinÃ¡micamente -->
            </div>

            <div class="sidebar-footer">
                <button class="btn-feature" onclick="toggleEmojis()">ğŸ˜€ Emojis</button>
                <button class="btn-feature" onclick="toggleGifs()">ğŸ¬ GIFs</button>
            </div>
        </aside>

        <!-- ÃREA DE CHAT -->
        <section class="chat-main">
            <div class="chat-header">
                <div class="chat-info">
                    <h2>ğŸ’¬ Chat Global de la Comunidad</h2>
                    <p class="chat-status">
                        <span class="status-dot"></span>
                        <span id="connectionStatus">Conectando...</span>
                    </p>
                </div>
                
                <div class="chat-actions">
                    {% if user.is_admin %}
                    <button class="btn-icon" onclick="clearChat()" title="Limpiar chat (Solo Admin)">
                        ğŸ—‘ï¸
                    </button>
                    {% endif %}
                    <button class="btn-icon" onclick="toggleNotifications()" title="Notificaciones">
                        ğŸ””
                    </button>
                    <button class="btn-icon" onclick="toggleFullscreen()" title="Pantalla completa">
                        â›¶
                    </button>
                </div>
            </div>

            <!-- MENSAJES -->
            <div class="messages-container" id="messagesContainer">
                <div class="welcome-message">
                    <div class="welcome-icon">ğŸ’¬</div>
                    <h3>Â¡Bienvenido al Chat Global!</h3>
                    <p>ConÃ©ctate con otros jugadores, comparte tus experiencias y haz nuevos amigos.</p>
                </div>
            </div>

            <!-- ÃREA DE ESCRITURA -->
            <div class="input-area">
                <!-- Barra de herramientas -->
                <div class="toolbar">
                    <button class="tool-btn" onclick="insertEmoji('ğŸ˜€')" title="Feliz">ğŸ˜€</button>
                    <button class="tool-btn" onclick="insertEmoji('ğŸ˜‚')" title="Risa">ğŸ˜‚</button>
                    <button class="tool-btn" onclick="insertEmoji('â¤ï¸')" title="Amor">â¤ï¸</button>
                    <button class="tool-btn" onclick="insertEmoji('ğŸ®')" title="Gaming">ğŸ®</button>
                    <button class="tool-btn" onclick="insertEmoji('ğŸ”¥')" title="Fuego">ğŸ”¥</button>
                    <button class="tool-btn" onclick="insertEmoji('ğŸ‘')" title="Like">ğŸ‘</button>
                    <button class="tool-btn" onclick="insertEmoji('â­')" title="Estrella">â­</button>
                    <button class="tool-btn" onclick="insertEmoji('ğŸ’')" title="Diamante">ğŸ’</button>
                </div>

                <!-- Input y botones -->
                <div class="input-wrapper">
                    <textarea 
                        id="messageInput" 
                        placeholder="Escribe tu mensaje... (Shift + Enter para nueva lÃ­nea)"
                        maxlength="500"
                        rows="1"></textarea>
                    
                    <div class="input-controls">
                        <span class="char-counter" id="charCounter">0/500</span>
                        <button class="btn-send" onclick="sendMessage()" id="sendBtn">
                            <span class="send-icon">ğŸ“¤</span>
                            <span class="send-text">Enviar</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- PANEL DE INFORMACIÃ“N -->
        <aside class="info-panel">
            <div class="panel-section">
                <h3>ğŸ“Š EstadÃ­sticas del Chat</h3>
                <div class="stat-item">
                    <span class="stat-label">Mensajes hoy:</span>
                    <span class="stat-value" id="todayMessages">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Tus mensajes:</span>
                    <span class="stat-value" id="userMessages">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Miembros activos:</span>
                    <span class="stat-value" id="activeMembers">0</span>
                </div>
            </div>

            <div class="panel-section">
                <h3>ğŸ“œ Reglas del Chat</h3>
                <ul class="rules-list">
                    <li>âœ… SÃ© respetuoso con todos</li>
                    <li>âœ… No spam ni flood</li>
                    <li>âœ… MantÃ©n el tema relacionado</li>
                    <li>âŒ No lenguaje ofensivo</li>
                    <li>âŒ No promociones no autorizadas</li>
                </ul>
            </div>

            <div class="panel-section">
                <h3>ğŸ¨ PersonalizaciÃ³n</h3>
                <div class="theme-selector">
                    <button class="theme-btn" data-theme="dark" onclick="changeTheme('dark')">
                        ğŸŒ™ Oscuro
                    </button>
                    <button class="theme-btn active" data-theme="red" onclick="changeTheme('red')">
                        ğŸ”´ Rojo
                    </button>
                    <button class="theme-btn" data-theme="blue" onclick="changeTheme('blue')">
                        ğŸ”µ Azul
                    </button>
                    <button class="theme-btn" data-theme="green" onclick="changeTheme('green')">
                        ğŸŸ¢ Verde
                    </button>
                </div>
            </div>

            <div class="panel-section">
                <h3>âš™ï¸ ConfiguraciÃ³n</h3>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="soundToggle" checked>
                        <span>Sonidos de notificaciÃ³n</span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="animationsToggle" checked>
                        <span>Animaciones</span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="timestampToggle" checked>
                        <span>Mostrar hora</span>
                    </label>
                </div>
            </div>
        </aside>
    </main>

    <!-- MODAL DE EMOJIS -->
    <div id="emojiModal" class="modal">
        <div class="modal-content emoji-picker">
            <span class="close" onclick="closeEmojiModal()">&times;</span>
            <h3>Selecciona un Emoji</h3>
            <div class="emoji-grid" id="emojiGrid">
                <!-- Emojis se generarÃ¡n dinÃ¡micamente -->
            </div>
        </div>
    </div>

    <!-- Variables globales para JavaScript -->
    <script>
        window.userData = {
            name: "{{ user.name }}",
            id: {{ user.id }},
            avatar: "{{ user.profile_picture if user.profile_picture else '/static/image/default-avatar.png' }}"
        };
    </script>
    
    <script src="/static/js/chat.js"></script>
</body>
</html>
